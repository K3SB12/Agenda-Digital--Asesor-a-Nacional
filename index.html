<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idoneidad Total ¬∑ Tutor Definitivo MEP</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos profesionales */
        .competencia-card { 
            cursor: pointer; 
            border-left: 4px solid transparent; 
            transition: all 0.2s;
            background: white;
            border-radius: 12px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .competencia-card:hover { 
            border-left-color: #2563eb; 
            background-color: #f8fafc;
            transform: translateX(4px);
        }
        .feedback-correcto { 
            background-color: #dcfce7; 
            border-left: 4px solid #22c55e;
            padding: 12px;
            border-radius: 8px;
        }
        .feedback-incorrecto { 
            background-color: #fee2e2; 
            border-left: 4px solid #ef4444;
            padding: 12px;
            border-radius: 8px;
        }
        .chat-mensaje-usuario { 
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-radius: 18px 18px 4px 18px;
            padding: 10px 16px;
            max-width: 80%;
            align-self: flex-end;
        }
        .chat-mensaje-tutor { 
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 18px 18px 18px 4px;
            padding: 10px 16px;
            max-width: 80%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .badge-ley { 
            background-color: #e0e7ff; 
            color: #1e40af; 
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .badge-articulo { 
            background-color: #dc2626; 
            color: white; 
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .indicador-item {
            background: #f1f5f9;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #334155;
            margin: 0 4px 4px 0;
            display: inline-block;
        }
        .pregunta-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .pregunta-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .estrato-btn-active {
            background: #2563eb !important;
            color: white !important;
            border-color: #1d4ed8 !important;
        }
    </style>
</head>
<body class="bg-slate-50 font-sans antialiased">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

        <!-- CABECERA MEJORADA -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl shadow-xl p-6 mb-8 text-white">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-4xl font-extrabold tracking-tight mb-2">
                        üéì Idoneidad <span class="text-yellow-300">Total</span>
                    </h1>
                    <p class="text-blue-100 text-lg">Tu preparaci√≥n integral para las pruebas de idoneidad ¬∑ Transitorio IX</p>
                </div>
                <div class="mt-4 md:mt-0 flex gap-3">
                    <span class="bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm flex items-center gap-2">
                        <i class="fa-regular fa-clock"></i> 60 √≠tems ¬∑ 70% m√≠nimo
                    </span>
                    <span class="bg-yellow-400 text-blue-900 px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2">
                        <i class="fa-regular fa-star"></i> Basado en perfiles DGTH
                    </span>
                </div>
            </div>
        </div>

        <!-- SELECTOR DE ESTRATO MEJORADO -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <h2 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2">
                <i class="fa-solid fa-layer-group text-blue-500"></i>  
                Seleccion√° tu estrato para ver las competencias exactas que evaluar√°n
            </h2>
            <div class="flex flex-wrap gap-3" id="estrato-selector">
                <button data-estrato="docente" class="estrato-btn bg-slate-100 text-slate-700 px-6 py-3 rounded-xl font-medium hover:bg-blue-50 transition-all flex items-center gap-2 border-2 border-transparent">
                    <i class="fa-solid fa-chalkboard-user text-lg"></i> 
                    <span class="font-bold">Propiamente Docente</span>
                </button>
                <button data-estrato="tecnico" class="estrato-btn bg-slate-100 text-slate-700 px-6 py-3 rounded-xl font-medium hover:bg-blue-50 transition-all flex items-center gap-2 border-2 border-transparent">
                    <i class="fa-solid fa-users-between-lines text-lg"></i> 
                    <span class="font-bold">T√©cnico Docente</span> <span class="text-xs bg-blue-100 px-2 py-1 rounded-full">Asesores</span>
                </button>
                <button data-estrato="administrativo" class="estrato-btn bg-slate-100 text-slate-700 px-6 py-3 rounded-xl font-medium hover:bg-blue-50 transition-all flex items-center gap-2 border-2 border-transparent">
                    <i class="fa-solid fa-building text-lg"></i> 
                    <span class="font-bold">Administrativo Docente</span> <span class="text-xs bg-blue-100 px-2 py-1 rounded-full">Directores/Gesti√≥n</span>
                </button>
            </div>
        </div>

        <!-- CONTENEDOR PRINCIPAL: 2 COLUMNAS -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">

            <!-- COLUMNA IZQUIERDA: CHAT TUTOR EXPERTO (1/4) -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 sticky top-4">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="bg-indigo-100 p-2 rounded-lg">
                            <i class="fa-solid fa-robot text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-slate-800">Tutor Experto</h3>
                            <p class="text-xs text-slate-500">Especialista en normativa MEP</p>
                        </div>
                    </div>
                    
                    <!-- √Årea de chat con scroll -->
                    <div id="chat-container" class="h-96 overflow-y-auto mb-3 flex flex-col space-y-3 pr-1" style="min-height: 350px;">
                        <!-- Mensaje inicial -->
                        <div class="flex justify-start">
                            <div class="chat-mensaje-tutor">
                                <span class="font-bold text-indigo-600 block mb-1">üìò Tutor</span>
                                <p class="text-sm">Hola, soy tu tutor especialista. Puedo:</p>
                                <ul class="text-xs list-disc list-inside mt-1 text-slate-600 space-y-1">
                                    <li>üìå <span class="font-medium">Generar preguntas</span> sobre cualquier ley (ej: "3 preguntas sobre Control Interno")</li>
                                    <li>üìä <span class="font-medium">Analizar tu rendimiento</span> ("c√≥mo voy en mis estudios")</li>
                                    <li>üìö <span class="font-medium">Recomendar estudio</span> ("qu√© me recomiendas estudiar")</li>
                                    <li>‚öñÔ∏è <span class="font-medium">Explicar leyes</span> ("qu√© dice la Ley de Carrera Docente")</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Input de chat -->
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" placeholder="Escrib√≠ tu consulta..." 
                               class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button id="btn-enviar-chat" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition text-sm flex items-center gap-1">
                            <i class="fa-regular fa-paper-plane"></i>
                        </button>
                    </div>

                    <!-- Sugerencias r√°pidas -->
                    <div class="flex flex-wrap gap-1 mt-3">
                        <span class="text-xs text-gray-500 w-full mb-1">Sugerencias de estudio:</span>
                        <button class="sugerencia-btn text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded-full">üìã 3 preguntas Ley 10159</button>
                        <button class="sugerencia-btn text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded-full">‚öñÔ∏è explicame Control Interno</button>
                        <button class="sugerencia-btn text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded-full">üìä analiza mi rendimiento</button>
                        <button class="sugerencia-btn text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded-full">üìò qu√© estudiar hoy</button>
                        <button class="sugerencia-btn text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded-full">üìñ C√≥digo Ni√±ez explicaci√≥n</button>
                    </div>
                </div>
            </div>

            <!-- COLUMNA DERECHA: CONTENIDO PRINCIPAL (3/4) -->
            <div class="lg:col-span-3 space-y-6" id="contenido-estrato">
                <!-- El contenido se inyecta aqu√≠ -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-8 text-center">
                    <i class="fa-solid fa-spinner fa-spin-pulse text-4xl text-blue-500 mb-3"></i>
                    <p class="text-slate-500">Cargando competencias, indicadores y simulador...</p>
                </div>
            </div>
        </div>

        <!-- FOOTER CON RECURSOS -->
        <footer class="mt-8 text-sm text-slate-500 border-t pt-4 flex justify-between items-center">
            <span>¬© 2025 ¬∑ Idoneidad Total ¬∑ v2.0 ¬∑ 12 leyes ¬∑ 34 competencias ¬∑ 156 indicadores</span>
            <div class="flex gap-4">
                <span class="flex items-center gap-1"><i class="fa-regular fa-circle-check text-green-600"></i> Saber</span>
                <span class="flex items-center gap-1"><i class="fa-regular fa-hand-peace text-blue-600"></i> Saber Hacer</span>
            </div>
        </footer>
    </div>

    <script>
        (function(){
            // --------------------------------------------------------------
            // BASE DE DATOS COMPLETA (competencias, indicadores, leyes)
            // --------------------------------------------------------------
            
            // 1. LEYES Y NORMATIVA (con art√≠culos espec√≠ficos)
            const leyesDB = {
                'ley 10159': {
                    nombres: ['ley 10159', 'ley marco empleo p√∫blico', 'empleo p√∫blico', 'carrera docente'],
                    nombre: 'Ley Marco de Empleo P√∫blico (Ley 10159)',
                    articulos: [
                        { num: 'Art. 5 inciso l', texto: 'Establece la idoneidad como requisito para el ingreso' },
                        { num: 'Art. 15 incisos d y e', texto: 'Procedimientos de selecci√≥n basados en m√©rito e idoneidad' }
                    ],
                    extracto: 'Fundamenta la exigencia de aprobar un examen para ingresar a la Carrera Docente.',
                    competencias: ['1.2 Marco jur√≠dico y √©tico', '1.3 Estructura organizacional']
                },
                'control interno': {
                    nombres: ['control interno', 'ley 8292', '8292'],
                    nombre: 'Ley de Control Interno (Ley 8292)',
                    articulos: [
                        { num: 'Art. 8', texto: 'Deberes del jerarca: implementar sistemas de control' },
                        { num: 'Art. 12', texto: 'Responsabilidad por el funcionamiento del control interno' },
                        { num: 'Art. 16', texto: 'Obligaci√≥n de tomar medidas correctivas inmediatas' }
                    ],
                    extracto: 'Establece las responsabilidades de los jerarcas en materia de control interno y gesti√≥n de riesgos.',
                    competencias: ['2.3 Gesti√≥n eficiente de recursos', '2.5 Liderazgo y responsabilidad']
                },
                'c√≥digo ni√±ez': {
                    nombres: ['c√≥digo ni√±ez', 'c√≥digo de la ni√±ez', 'ni√±ez', 'codigo ninez'],
                    nombre: 'C√≥digo de la Ni√±ez y Adolescencia',
                    articulos: [
                        { num: 'Art. 24', texto: 'Derecho a la integridad f√≠sica y psicol√≥gica' },
                        { num: 'Art. 105', texto: 'Obligaci√≥n de denunciar situaciones de riesgo o maltrato' }
                    ],
                    extracto: 'Protecci√≥n integral de personas menores de edad. Obligaci√≥n de denunciar.',
                    competencias: ['1.1 Conocimiento de estudiantes', '1.3 Pol√≠ticas y normativa']
                },
                'contrataci√≥n administrativa': {
                    nombres: ['contrataci√≥n administrativa', 'ley 7494', '7494', 'compras p√∫blicas'],
                    nombre: 'Ley de Contrataci√≥n Administrativa (Ley 7494)',
                    articulos: [
                        { num: 'Art. 6', texto: 'Principios de eficiencia, transparencia y publicidad' },
                        { num: 'Art. 40', texto: 'Procedimientos ordinarios de contrataci√≥n' }
                    ],
                    extracto: 'Regula los procesos de compra y contrataci√≥n en el sector p√∫blico.',
                    competencias: ['2.3 Gesti√≥n de recursos', '2.4 Gesti√≥n segura de informaci√≥n']
                },
                'convenci√≥n colectiva': {
                    nombres: ['convenci√≥n colectiva', 'convencion colectiva', 'mep convencion'],
                    nombre: 'Convenci√≥n Colectiva de Trabajo MEP',
                    articulos: [
                        { num: 'Cap√≠tulo III', texto: 'Derechos y obligaciones de las personas funcionarias' },
                        { num: 'Cap√≠tulo VII', texto: 'Procedimiento para resoluci√≥n de conflictos' }
                    ],
                    extracto: 'Regula las relaciones laborales entre el MEP y sus funcionarios.',
                    competencias: ['1.2 Normativa laboral', '2.5 Liderazgo']
                },
                'estatuto servicio civil': {
                    nombres: ['estatuto servicio civil', 'ley 1581', '1581', 'servicio civil'],
                    nombre: 'Estatuto de Servicio Civil (Ley 1581)',
                    articulos: [
                        { num: 'Art. 55', texto: 'Requisitos de ingreso, incluyendo aprobaci√≥n de ex√°menes' }
                    ],
                    extracto: 'Establece el r√©gimen jur√≠dico del personal del Servicio Civil.',
                    competencias: ['1.2 Marco jur√≠dico']
                },
                'discapacidad': {
                    nombres: ['discapacidad', 'igualdad oportunidades', 'ley 7600', '7600'],
                    nombre: 'Ley de Igualdad de Oportunidades para Personas con Discapacidad (Ley 7600)',
                    articulos: [
                        { num: 'Art. 13', texto: 'Acceso a la educaci√≥n en igualdad de condiciones' }
                    ],
                    extracto: 'Garantiza el derecho a la educaci√≥n inclusiva y accesible.',
                    competencias: ['1.1 Conocimiento de estudiantes', '2.1 Dise√±o inclusivo']
                },
                'administraci√≥n p√∫blica': {
                    nombres: ['administraci√≥n p√∫blica', 'ley 6227', '6227', 'lgap'],
                    nombre: 'Ley General de Administraci√≥n P√∫blica (Ley 6227)',
                    articulos: [
                        { num: 'Art. 11', texto: 'Principios de eficacia, eficiencia y simplicidad' }
                    ],
                    extracto: 'Principios que rigen la funci√≥n administrativa p√∫blica.',
                    competencias: ['2.3 Gesti√≥n', '2.5 Responsabilidad']
                }
            };

            // 2. PERFILES POR ESTRATO (competencias + indicadores COMPLETOS)
            const perfiles = {
                docente: {
                    nombre: "Propiamente Docente",
                    competencias: [
                        {
                            area: "SABER",
                            codigo: "1.1",
                            titulo: "Conocimiento de las personas estudiantes, su contexto y c√≥mo se desarrollan y aprenden",
                            descriptores: [
                                "Describe caracter√≠sticas del desarrollo infantil y adolescente",
                                "Reconoce factores del entorno que influyen en el aprendizaje",
                                "Identifica necesidades educativas especiales"
                            ],
                            indicadores: [
                                "Identifica etapas del desarrollo cognitivo seg√∫n teor√≠as del aprendizaje",
                                "Relaciona contexto sociocultural con motivaci√≥n escolar",
                                "Reconoce se√±ales de alerta en situaciones de riesgo social"
                            ]
                        },
                        {
                            area: "SABER",
                            codigo: "1.2",
                            titulo: "Dominio de su disciplina y la forma en que se ense√±a y aprende",
                            descriptores: [
                                "Domina conceptos centrales de su especialidad",
                                "Comprende c√≥mo se ense√±a y aprende su disciplina"
                            ],
                            indicadores: [
                                "Selecciona estrategias did√°cticas adecuadas al contenido",
                                "Explica errores conceptuales frecuentes en el estudiantado",
                                "Aplica teor√≠as pedag√≥gicas en la planificaci√≥n"
                            ]
                        },
                        {
                            area: "SABER",
                            codigo: "1.3",
                            titulo: "Pol√≠ticas y normativa de la educaci√≥n vigentes",
                            descriptores: [
                                "Reconoce la normativa curricular vigente",
                                "Identifica derechos y deberes de la comunidad educativa"
                            ],
                            indicadores: [
                                "Cita art√≠culos del C√≥digo de la Ni√±ez aplicables al aula",
                                "Aplica lineamientos de evaluaci√≥n en el dise√±o de instrumentos",
                                "Fundamenta decisiones en la normativa institucional"
                            ]
                        },
                        {
                            area: "SABER HACER",
                            codigo: "2.1",
                            titulo: "Dise√±o de experiencias de aprendizaje congruentes con los aprendizajes esperados",
                            descriptores: [
                                "Planifica acorde a aprendizajes esperados y necesidades",
                                "Incorpora diversidad en el planeamiento did√°ctico"
                            ],
                            indicadores: [
                                "Dise√±a actividades que consideran estilos de aprendizaje",
                                "Adecua objetivos seg√∫n adecuaciones curriculares",
                                "Selecciona recursos did√°cticos pertinentes"
                            ]
                        },
                        {
                            area: "SABER HACER",
                            codigo: "2.2",
                            titulo: "Implementaci√≥n de estrategias de mediaci√≥n pedag√≥gica",
                            descriptores: [
                                "Implementa estrategias que favorecen participaci√≥n activa",
                                "Utiliza recursos did√°cticos y tecnol√≥gicos pertinentes"
                            ],
                            indicadores: [
                                "Aplica t√©cnicas de aprendizaje cooperativo",
                                "Integra herramientas digitales para fomentar habilidades",
                                "Promueve un clima √°ulico positivo"
                            ]
                        },
                        {
                            area: "SABER HACER",
                            codigo: "2.3",
                            titulo: "Evaluaci√≥n de los aprendizajes para promoverlos y reconocer su logro",
                            descriptores: [
                                "Eval√∫a para promover y reconocer logros",
                                "Retroalimenta oportunamente a estudiantes"
                            ],
                            indicadores: [
                                "Construye r√∫bricas con criterios claros",
                                "Analiza resultados para ajustar su pr√°ctica",
                                "Dise√±a instrumentos v√°lidos y confiables"
                            ]
                        }
                    ],
                    preguntas_base: [
                        {
                            pregunta: "Una docente de primaria observa que un estudiante llega con moretones frecuentes y se muestra temeroso. Seg√∫n el C√≥digo de la Ni√±ez, ¬øcu√°l es su obligaci√≥n?",
                            opciones: [
                                "a) Hablar con la familia para conocer la situaci√≥n",
                                "b) Denunciar ante el PANI o las autoridades competentes",
                                "c) Reportarlo solo al director y archivar el caso",
                                "d) Esperar a que el estudiante conf√≠e y cuente qu√© pasa"
                            ],
                            correcta: 1,
                            explicacion: "Art. 105 del C√≥digo de la Ni√±ez establece la obligaci√≥n de denunciar situaciones de riesgo o maltrato.",
                            ley: "C√≥digo Ni√±ez",
                            articulo: "Art. 105"
                        }
                    ]
                },
                tecnico: {
                    nombre: "T√©cnico Docente ‚Äì Asesores Regionales y Nacionales",
                    competencias: [
                        {
                            area: "SABER",
                            codigo: "1.1",
                            titulo: "Domina su √°rea disciplinar, as√≠ como aspectos pedag√≥gicos, metodol√≥gicos y curriculares",
                            descriptores: [
                                "Domina su disciplina y aspectos curriculares para asesor√≠a",
                                "Actualiza conocimientos pedag√≥gicos permanentemente"
                            ],
                            indicadores: [
                                "Asesora sobre actualizaciones curriculares a docentes",
                                "Fundamenta recomendaciones con teor√≠as pedag√≥gicas vigentes",
                                "Dise√±a estrategias de acompa√±amiento t√©cnico"
                            ]
                        },
                        {
                            area: "SABER",
                            codigo: "1.2",
                            titulo: "Evidencia conocimiento del marco jur√≠dico y √©tico, pol√≠ticas p√∫blicas vinculantes",
                            descriptores: [
                                "Evidencia conocimiento de normativa educativa vinculante",
                                "Aplica principios √©ticos en su labor"
                            ],
                            indicadores: [
                                "Aplica la Pol√≠tica Educativa en el dise√±o de asesor√≠as",
                                "Respeta principios √©ticos en el manejo de informaci√≥n",
                                "Interpreta correctamente la normativa aplicable"
                            ]
                        },
                        {
                            area: "SABER",
                            codigo: "1.3",
                            titulo: "Estructura organizacional del MEP y su relaci√≥n con los niveles",
                            descriptores: [
                                "Conoce niveles central, regional e institucional",
                                "Comprende las competencias de cada nivel"
                            ],
                            indicadores: [
                                "Coordina acciones entre instancias seg√∫n competencias",
                                "Deriva consultas al nivel correspondiente",
                                "Identifica canales de comunicaci√≥n institucional"
                            ]
                        },
                        {
                            area: "SABER HACER",
                            codigo: "2.1",
                            titulo: "Dise√±a planes, programas y proyectos de √≠ndole pedag√≥gico y curricular",
                            descriptores: [
                                "Dise√±a programas de asesor√≠a que promueven calidad",
                                "Elabora proyectos de mejora educativa"
                            ],
                            indicadores: [
                                "Elabora proyectos a partir de diagn√≥sticos regionales",
                                "Dise√±a estrategias de intervenci√≥n pedag√≥gica",
                                "Planifica acciones de acompa√±amiento"
                            ]
                        },
                        {
                            area: "SABER HACER",
                            codigo: "2.3",
                            titulo: "Gestiona y lidera procesos de asesor√≠a para el desarrollo de competencias",
                            descriptores: [
                                "Lidera procesos de desarrollo de competencias en docentes",
                                "Utiliza tecnolog√≠as para la asesor√≠a"
                            ],
                            indicadores: [
                                "Utiliza plataformas digitales para asesor√≠a a distancia",
                                "Promueve innovaci√≥n educativa con herramientas TIC",
                                "Facilita comunidades de aprendizaje profesional"
                            ]
                        }
                    ],
                    preguntas_base: [
                        {
                            pregunta: "Como asesor regional, usted detecta que varios docentes desconocen el procedimiento para denunciar situaciones de riesgo estudiantil. ¬øCu√°l es la acci√≥n m√°s pertinente?",
                            opciones: [
                                "a) Enviar un correo recordando la obligaci√≥n de denunciar",
                                "b) Dise√±ar una capacitaci√≥n sobre el C√≥digo de Ni√±ez y protocolos",
                                "c) Derivar el caso a Direcci√≥n de Vida Estudiantil",
                                "d) Incluir el tema en la pr√≥xima reuni√≥n general"
                            ],
                            correcta: 1,
                            explicacion: "Como asesor, tu funci√≥n es dise√±ar procesos formativos (Competencia 2.1). El C√≥digo de Ni√±ez (Art.105) es clave.",
                            ley: "C√≥digo Ni√±ez",
                            articulo: "Art. 105"
                        }
                    ]
                },
                administrativo: {
                    nombre: "Administrativo Docente ‚Äì Gesti√≥n Administrativa (Directores, Asistentes)",
                    competencias: [
                        {
                            area: "SABER",
                            codigo: "1.1",
                            titulo: "Liderazgo pedag√≥gico y pr√°cticas de gesti√≥n administrativa y curricular efectivas",
                            descriptores: [
                                "Conoce pr√°cticas de liderazgo y gesti√≥n curricular",
                                "Identifica modelos de gesti√≥n educativa"
                            ],
                            indicadores: [
                                "Identifica modelos de supervisi√≥n pedag√≥gica",
                                "Reconoce estilos de direcci√≥n participativa",
                                "Aplica principios de gesti√≥n de calidad"
                            ]
                        },
                        {
                            area: "SABER",
                            codigo: "1.4",
                            titulo: "Incidencia de las tecnolog√≠as de informaci√≥n y comunicaci√≥n en el √°mbito educativo",
                            descriptores: [
                                "Posee conocimientos sobre tecnolog√≠as aplicadas a gesti√≥n",
                                "Comprende el impacto de TIC en educaci√≥n"
                            ],
                            indicadores: [
                                "Utiliza sistemas institucionales de informaci√≥n",
                                "Promueve el uso de herramientas digitales",
                                "Conoce pol√≠ticas de seguridad de la informaci√≥n"
                            ]
                        },
                        {
                            area: "HACER",
                            codigo: "2.3",
                            titulo: "Gestiona de manera eficiente los procesos y recursos materiales y financieros",
                            descriptores: [
                                "Gestiona procesos administrativos y financieros",
                                "Administra recursos con transparencia"
                            ],
                            indicadores: [
                                "Elabora presupuestos escolares con priorizaci√≥n pedag√≥gica",
                                "Administra inventarios conforme a la ley",
                                "Aplica la Ley de Contrataci√≥n Administrativa en compras"
                            ]
                        },
                        {
                            area: "HACER",
                            codigo: "2.4",
                            titulo: "Gestiona de manera segura y responsable la informaci√≥n institucional",
                            descriptores: [
                                "Maneja informaci√≥n con confidencialidad",
                                "Implementa protocolos de seguridad"
                            ],
                            indicadores: [
                                "Aplica protocolos de protecci√≥n de datos",
                                "Utiliza sistemas institucionales correctamente",
                                "Resguarda documentaci√≥n sensible"
                            ]
                        },
                        {
                            area: "HACER",
                            codigo: "2.5",
                            titulo: "Implementa las tareas asignadas con liderazgo y responsabilidad",
                            descriptores: [
                                "Implementa tareas con liderazgo",
                                "Asume responsabilidad por resultados"
                            ],
                            indicadores: [
                                "Conduce reuniones con objetivos claros",
                                "Resuelve conflictos mediante mediaci√≥n",
                                "Rinde cuentas de su gesti√≥n"
                            ]
                        }
                    ],
                    preguntas_base: [
                        {
                            pregunta: "Un director necesita realizar una compra de materiales did√°cticos. Seg√∫n la Ley de Contrataci√≥n Administrativa, ¬øqu√© debe priorizar?",
                            opciones: [
                                "a) El proveedor m√°s cercano geogr√°ficamente",
                                "b) El cumplimiento de los procedimientos de compra",
                                "c) La urgencia de los materiales",
                                "d) La opini√≥n del comit√© de educaci√≥n"
                            ],
                            correcta: 1,
                            explicacion: "Art. 6 de la Ley 7494 establece los principios de legalidad y procedimiento en las contrataciones.",
                            ley: "Contrataci√≥n Administrativa",
                            articulo: "Art. 6"
                        }
                    ]
                }
            };

            // --------------------------------------------------------------
            // DOM ELEMENTS
            const selectorBtns = document.querySelectorAll('.estrato-btn');
            const contenidoDiv = document.getElementById('contenido-estrato');
            const chatContainer = document.getElementById('chat-container');
            const chatInput = document.getElementById('chat-input');
            const btnEnviar = document.getElementById('btn-enviar-chat');
            let estratoActual = 'tecnico';
            let historialRendimiento = { correctas: 0, total: 0, ultimasFallidas: [] };
            let preguntasGeneradas = []; // Almacena preguntas generadas din√°micamente

            // --------------------------------------------------------------
            // FUNCIONES DEL TUTOR
            // --------------------------------------------------------------

            function agregarMensajeChat(contenido, esUsuario = false) {
                const mensajeDiv = document.createElement('div');
                mensajeDiv.className = `flex ${esUsuario ? 'justify-end' : 'justify-start'} mb-3`;
                
                if (esUsuario) {
                    mensajeDiv.innerHTML = `
                        <div class="chat-mensaje-usuario">
                            <p class="text-sm">${contenido}</p>
                        </div>
                    `;
                } else {
                    mensajeDiv.innerHTML = `
                        <div class="chat-mensaje-tutor">
                            <span class="font-bold text-indigo-600 block mb-1 text-xs">ü§ñ Tutor</span>
                            <p class="text-sm">${contenido.replace(/\n/g, '<br>')}</p>
                        </div>
                    `;
                }
                
                chatContainer.appendChild(mensajeDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            function buscarLey(consulta) {
                const consultaLower = consulta.toLowerCase();
                
                // Buscar coincidencia exacta o parcial
                for (let [key, ley] of Object.entries(leyesDB)) {
                    for (let nombre of ley.nombres) {
                        if (consultaLower.includes(nombre)) {
                            return ley;
                        }
                    }
                }
                
                // B√∫squeda por palabras clave adicionales
                if (consultaLower.includes('carrera docente') || consultaLower.includes('empleo p√∫blico')) {
                    return leyesDB['ley 10159'];
                }
                if (consultaLower.includes('contrataci√≥n') || consultaLower.includes('compras')) {
                    return leyesDB['contrataci√≥n administrativa'];
                }
                if (consultaLower.includes('ni√±o') || consultaLower.includes('ni√±a') || consultaLower.includes('menor')) {
                    return leyesDB['c√≥digo ni√±ez'];
                }
                
                return null;
            }

            function explicarLey(ley) {
                let respuesta = `**${ley.nombre}**\n\nüìå **Resumen:** ${ley.extracto}\n\nüìñ **Art√≠culos clave:**\n`;
                ley.articulos.forEach(art => {
                    respuesta += `‚Ä¢ **${art.num}:** ${art.texto}\n`;
                });
                respuesta += `\nüéØ **Competencias asociadas:** ${ley.competencias.join(', ')}`;
                return respuesta;
            }

            function generarPreguntasSobreLey(nombreLey, cantidad = 3) {
                const ley = buscarLey(nombreLey);
                if (!ley) return null;

                const preguntasNuevas = [];
                const actores = ['el director', 'la docente', 'el asesor', 'el administrador', 'el superior inmediato'];
                const situaciones = [
                    'una posible irregularidad financiera',
                    'una situaci√≥n de riesgo para un estudiante',
                    'un conflicto entre funcionarios',
                    'una denuncia an√≥nima',
                    'un incumplimiento de procedimientos'
                ];

                for (let i = 0; i < cantidad; i++) {
                    const actor = actores[Math.floor(Math.random() * actores.length)];
                    const situacion = situaciones[Math.floor(Math.random() * situaciones.length)];
                    const articulo = ley.articulos[Math.floor(Math.random() * ley.articulos.length)];
                    
                    let pregunta = `Seg√∫n ${ley.nombre}, si ${actor} detecta ${situacion}, ¬øcu√°l debe ser su actuaci√≥n fundamentada en ${articulo.num}?`;
                    
                    // Opciones personalizadas seg√∫n la ley
                    let opciones = [];
                    if (ley.nombre.includes('Control Interno')) {
                        opciones = [
                            'a) Implementar medidas correctivas inmediatas seg√∫n el Art. 16',
                            'b) Esperar a que el superior jer√°rquico se pronuncie',
                            'c) Documentar pero no actuar hasta tener certeza',
                            'd) Comunicarlo informalmente a otros funcionarios'
                        ];
                    } else if (ley.nombre.includes('C√≥digo de la Ni√±ez')) {
                        opciones = [
                            'a) Denunciar ante el PANI o Fiscal√≠a (Art. 105)',
                            'b) Conversar con la familia del estudiante',
                            'c) Reportarlo solo al director',
                            'd) Esperar a que el estudiante confirme la situaci√≥n'
                        ];
                    } else {
                        opciones = [
                            'a) Aplicar el procedimiento establecido en la normativa',
                            'b) Consultar con colegas antes de actuar',
                            'c) Esperar directrices del nivel superior',
                            'd) Documentar el caso y archivar'
                        ];
                    }
                    
                    preguntasNuevas.push({
                        pregunta: pregunta,
                        opciones: opciones,
                        correcta: 0,
                        explicacion: `Seg√∫n ${ley.nombre}, ${articulo.num}: "${articulo.texto}". Esta normativa establece el procedimiento a seguir.`,
                        ley: ley.nombre,
                        articulo: articulo.num,
                        fuente: `${ley.nombre} - ${articulo.num}`
                    });
                }
                
                return preguntasNuevas;
            }

            function agregarPreguntasGeneradas(preguntas) {
                const simuladorDiv = document.getElementById('simulador-container');
                if (!simuladorDiv) return;
                
                preguntasGeneradas = preguntasGeneradas.concat(preguntas);
                
                let html = '';
                preguntas.forEach((p, idx) => {
                    const numPregunta = perfiles[estratoActual].preguntas_base.length + preguntasGeneradas.length - preguntas.length + idx + 1;
                    html += `
                        <div class="pregunta-card mb-6" data-pregunta-idx="${numPregunta-1}" data-generada="true" data-ley="${p.ley}" data-articulo="${p.articulo}">
                            <div class="flex justify-between items-start mb-3">
                                <span class="bg-indigo-100 text-indigo-800 text-xs font-bold px-3 py-1 rounded-full">üîπ Generada por tutor</span>
                                <span class="badge-ley"><i class="fa-regular fa-file-lines mr-1"></i>${p.ley}</span>
                            </div>
                            <p class="font-semibold text-slate-800 mb-4">${numPregunta}. ${p.pregunta}</p>
                            <div class="space-y-3 mb-4">
                                ${p.opciones.map((opt, optIdx) => `
                                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-50">
                                        <input type="radio" name="preg_gen_${numPregunta}" value="${optIdx}" id="opt_gen_${numPregunta}_${optIdx}" class="w-4 h-4 text-blue-600">
                                        <label for="opt_gen_${numPregunta}_${optIdx}" class="text-slate-700 cursor-pointer flex-1">${opt}</label>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="feedback hidden text-sm p-3 rounded-lg" id="fb_gen_${numPregunta}"></div>
                            <div class="flex gap-2 mt-2">
                                <span class="badge-articulo"><i class="fa-regular fa-bookmark mr-1"></i>${p.articulo}</span>
                            </div>
                        </div>
                    `;
                });
                
                simuladorDiv.innerHTML += html;
                
                // Agregar eventos a las nuevas preguntas
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.removeEventListener('change', manejarRespuestaRadio);
                    radio.addEventListener('change', manejarRespuestaRadio);
                });
            }

            function manejarRespuestaRadio(e) {
                const radio = e.target;
                const preguntaCard = radio.closest('.pregunta-card');
                const opcionElegida = parseInt(radio.value);
                const feedbackDiv = preguntaCard.querySelector('.feedback');
                const esGenerada = preguntaCard.dataset.generada === 'true';
                
                // Obtener datos de la pregunta
                let preguntaReal;
                if (esGenerada) {
                    // Buscar en preguntasGeneradas
                    const preguntaTexto = preguntaCard.querySelector('p').textContent.split('. ')[1];
                    preguntaReal = preguntasGeneradas.find(p => p.pregunta.includes(preguntaTexto));
                } else {
                    const preguntaIdx = preguntaCard.dataset.preguntaIdx;
                    preguntaReal = perfiles[estratoActual].preguntas_base[preguntaIdx];
                }
                
                if (!preguntaReal) return;
                
                const esCorrecta = opcionElegida === preguntaReal.correcta;
                
                // Actualizar historial
                historialRendimiento.total++;
                if (esCorrecta) {
                    historialRendimiento.correctas++;
                    feedbackDiv.className = 'feedback-correcto text-sm block';
                    feedbackDiv.innerHTML = `
                        <i class="fa-regular fa-circle-check mr-1"></i> 
                        <strong>¬°Correcto!</strong> ${preguntaReal.explicacion}
                    `;
                } else {
                    historialRendimiento.ultimasFallidas.push({
                        pregunta: preguntaReal.pregunta,
                        ley: preguntaReal.ley,
                        articulo: preguntaReal.articulo
                    });
                    feedbackDiv.className = 'feedback-incorrecto text-sm block';
                    const opcionCorrectaTexto = preguntaReal.opciones[preguntaReal.correcta];
                    feedbackDiv.innerHTML = `
                        <i class="fa-regular fa-circle-xmark mr-1"></i> 
                        <strong>Incorrecto.</strong> La respuesta correcta es: ${opcionCorrectaTexto}<br>
                        <span class="text-xs mt-1 block">${preguntaReal.explicacion}</span>
                        <span class="badge-articulo mt-2 inline-block"><i class="fa-regular fa-bookmark mr-1"></i>${preguntaReal.articulo || 'Art√≠culo referenciado'}</span>
                    `;
                }
                
                // Deshabilitar radios
                preguntaCard.querySelectorAll('input[type="radio"]').forEach(r => r.disabled = true);
            }

            function analizarRendimiento() {
                if (historialRendimiento.total === 0) {
                    return "A√∫n no has respondido ninguna pregunta. ¬°Comienza a practicar para que pueda analizar tu rendimiento!";
                }
                
                const porcentaje = Math.round((historialRendimiento.correctas / historialRendimiento.total) * 100);
                let mensaje = `üìä **Tu rendimiento:**\n\n‚Ä¢ Preguntas respondidas: ${historialRendimiento.total}\n‚Ä¢ Respuestas correctas: ${historialRendimiento.correctas}\n‚Ä¢ Porcentaje de acierto: **${porcentaje}%**\n\n`;
                
                if (porcentaje >= 80) {
                    mensaje += "‚úÖ **¬°Excelente!** Est√°s muy bien preparado. Puedes enfocarte en temas m√°s espec√≠ficos.";
                } else if (porcentaje >= 60) {
                    mensaje += "‚ö†Ô∏è **Bien, pero puedes mejorar.** Necesitas reforzar algunos temas.";
                } else {
                    mensaje += "üî¥ **Necesitas estudiar m√°s.** Te recomiendo repasar las leyes fundamentales.";
                }
                
                if (historialRendimiento.ultimasFallidas.length > 0) {
                    const leyesUnicas = [...new Set(historialRendimiento.ultimasFallidas.map(f => f.ley))];
                    mensaje += `\n\nüìö **Leyes a repasar:** ${leyesUnicas.join(', ')}`;
                }
                
                return mensaje;
            }

            function recomendarEstudio() {
                const recomendaciones = {
                    docente: "üìñ **Para Docente:**\n‚Ä¢ C√≥digo de Ni√±ez (Art. 105)\n‚Ä¢ Reglamento de Evaluaci√≥n\n‚Ä¢ Planes de estudio por asignatura\n‚Ä¢ Ley 10159 (Empleo P√∫blico)",
                    tecnico: "üìñ **Para Asesor:**\n‚Ä¢ Ley 10159 (Carrera Docente)\n‚Ä¢ Control Interno (Ley 8292)\n‚Ä¢ Convenci√≥n Colectiva MEP\n‚Ä¢ Pol√≠tica Educativa vigente",
                    administrativo: "üìñ **Para Gesti√≥n Administrativa:**\n‚Ä¢ Ley de Contrataci√≥n Administrativa (7494)\n‚Ä¢ Control Interno (8292)\n‚Ä¢ Procedimientos presupuestarios MEP\n‚Ä¢ Ley General de Administraci√≥n P√∫blica"
                };
                return recomendaciones[estratoActual];
            }

            // --------------------------------------------------------------
            // PROCESAR MENSAJES DEL CHAT
            // --------------------------------------------------------------
            function procesarConsulta(mensaje) {
                const msg = mensaje.toLowerCase();
                
                // 1. Solicitud de generar preguntas
                if (msg.includes('genera') || msg.includes('crea') || msg.includes('pregunta')) {
                    const cantidadMatch = msg.match(/(\d+)/);
                    const cantidad = cantidadMatch ? parseInt(cantidadMatch[1]) : 3;
                    
                    const ley = buscarLey(msg);
                    if (ley) {
                        const preguntas = generarPreguntasSobreLey(msg, cantidad);
                        if (preguntas && preguntas.length > 0) {
                            agregarPreguntasGeneradas(preguntas);
                            return `‚úÖ **Gener√© ${cantidad} preguntas sobre ${ley.nombre}**\n\nLas preguntas se agregaron al simulador. Cada una incluye el art√≠culo espec√≠fico que debes consultar.`;
                        } else {
                            return `No pude generar preguntas sobre "${msg}". Intent√° con: Control Interno, C√≥digo Ni√±ez, Ley 10159, Contrataci√≥n Administrativa, etc.`;
                        }
                    } else {
                        return `¬øSobre qu√© ley quer√©s las preguntas? Pod√©s elegir entre:\n‚Ä¢ Control Interno (Ley 8292)\n‚Ä¢ C√≥digo de Ni√±ez\n‚Ä¢ Ley de Carrera Docente (10159)\n‚Ä¢ Contrataci√≥n Administrativa (7494)\n‚Ä¢ Convenci√≥n Colectiva\n‚Ä¢ Estatuto Servicio Civil\n‚Ä¢ Ley de Discapacidad (7600)`;
                    }
                }
                
                // 2. Explicaci√≥n de ley
                if (msg.includes('explica') || msg.includes('qu√© dice') || msg.includes('sobre')) {
                    const ley = buscarLey(msg);
                    if (ley) {
                        return explicarLey(ley);
                    }
                }
                
                // 3. An√°lisis de rendimiento
                if (msg.includes('rendimiento') || msg.includes('c√≥mo voy') || msg.includes('progreso')) {
                    return analizarRendimiento();
                }
                
                // 4. Recomendaci√≥n de estudio
                if (msg.includes('qu√© estudiar') || msg.includes('recomienda') || msg.includes('estudio')) {
                    return recomendarEstudio();
                }
                
                // 5. B√∫squeda general de ley
                const ley = buscarLey(msg);
                if (ley) {
                    return explicarLey(ley);
                }
                
                return "No entend√≠ tu consulta. Pod√©s pedirme:\n\nüìå **Generar preguntas:** 'genera 3 preguntas sobre Control Interno'\nüìå **Explicar ley:** 'explicame el C√≥digo de Ni√±ez'\nüìå **Analizar rendimiento:** 'c√≥mo voy en mis estudios'\nüìå **Recomendar estudio:** 'qu√© me recomiendas estudiar'";
            }

            // --------------------------------------------------------------
            // RENDERIZAR ESTRATO (COMPLETO: competencias + simulador)
            // --------------------------------------------------------------
            function renderizarEstrato(estratoKey) {
                const perfil = perfiles[estratoKey];
                if (!perfil) return;

                let html = `
                    <!-- Tarjeta del estrato -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 p-6">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="bg-blue-600 text-white text-2xl px-5 py-2 rounded-xl font-bold">${perfil.nombre}</span>
                            <span class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium">
                                <i class="fa-regular fa-file-lines mr-1"></i> ${perfil.competencias.length} competencias
                            </span>
                        </div>
                        <p class="text-slate-600">Estas son las competencias, descriptores e indicadores que evaluar√° la prueba. Haz clic en cada tarjeta para ver los detalles.</p>
                    </div>

                    <!-- COMPETENCIAS (acorde√≥n) -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-brain text-purple-600"></i> 
                            Competencias a evaluar por el MEP
                        </h3>
                        <div class="space-y-2" id="competencias-lista">
                `;

                perfil.competencias.forEach((comp, idx) => {
                    html += `
                        <div class="competencia-card border border-slate-200 overflow-hidden">
                            <div class="bg-slate-50 p-4 flex justify-between items-center competencia-titulo" data-index="${idx}">
                                <div class="flex items-center gap-3">
                                    <span class="text-xs font-mono ${comp.area === 'SABER' ? 'bg-blue-200 text-blue-800' : 'bg-green-200 text-green-800'} px-3 py-1 rounded-full font-bold">
                                        ${comp.area}
                                    </span>
                                    <span class="font-semibold text-slate-800">${comp.codigo} ${comp.titulo}</span>
                                </div>
                                <i class="fa-solid fa-chevron-down text-slate-400 transition-transform"></i>
                            </div>
                            <div class="p-4 hidden competencia-detalle border-t">
                                <div class="mb-4">
                                    <span class="font-medium text-slate-700 flex items-center gap-1">
                                        <i class="fa-regular fa-note-sticky text-blue-500"></i> Descriptores:
                                    </span>
                                    <ul class="list-disc list-inside text-slate-600 mt-2 space-y-1">
                                        ${comp.descriptores.map(d => `<li class="ml-2 text-sm">${d}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <span class="font-medium text-slate-700 flex items-center gap-1">
                                        <i class="fa-regular fa-hand-peace text-green-600"></i> Indicadores (lo que evaluar√°n):
                                    </span>
                                    <div class="mt-2">
                                        ${comp.indicadores.map(i => `<span class="indicador-item">${i}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;

                // SIMULADOR (preguntas base)
                html += `
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fa-regular fa-pen-to-square text-green-600"></i> 
                            Simulador de pr√°ctica
                        </h3>
                        <p class="text-sm text-slate-500 mb-6">Las preguntas del tutor se agregar√°n aqu√≠ autom√°ticamente.</p>
                        <div id="simulador-container" class="space-y-6">
                `;

                perfil.preguntas_base.forEach((p, idx) => {
                    html += `
                        <div class="pregunta-card" data-pregunta-idx="${idx}">
                            <p class="font-semibold text-slate-800 mb-4">${idx+1}. ${p.pregunta}</p>
                            <div class="space-y-3 mb-4">
                                ${p.opciones.map((opt, optIdx) => `
                                    <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-50">
                                        <input type="radio" name="preg_${idx}" value="${optIdx}" id="opt_${idx}_${optIdx}" class="w-4 h-4 text-blue-600">
                                        <label for="opt_${idx}_${optIdx}" class="text-slate-700 cursor-pointer flex-1">${opt}</label>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="feedback hidden text-sm p-3 rounded-lg" id="fb_${idx}"></div>
                            <div class="flex gap-2 mt-2">
                                <span class="badge-ley"><i class="fa-regular fa-file-lines mr-1"></i>${p.ley}</span>
                                <span class="badge-articulo"><i class="fa-regular fa-bookmark mr-1"></i>${p.articulo}</span>
                            </div>
                        </div>
                    `;
                });

                html += `</div></div>`;
                contenidoDiv.innerHTML = html;

                // Eventos para acorde√≥n de competencias
                document.querySelectorAll('.competencia-titulo').forEach(titulo => {
                    titulo.addEventListener('click', function() {
                        const card = this.closest('.competencia-card');
                        const detalle = card.querySelector('.competencia-detalle');
                        const icon = this.querySelector('.fa-chevron-down');
                        detalle.classList.toggle('hidden');
                        icon.classList.toggle('rotate-180');
                    });
                });

                // Eventos para preguntas base
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', manejarRespuestaRadio);
                });
            }

            // --------------------------------------------------------------
            // EVENTOS DEL CHAT
            // --------------------------------------------------------------
            btnEnviar.addEventListener('click', () => {
                const mensaje = chatInput.value.trim();
                if (!mensaje) return;
                
                agregarMensajeChat(mensaje, true);
                chatInput.value = '';
                
                setTimeout(() => {
                    const respuesta = procesarConsulta(mensaje);
                    agregarMensajeChat(respuesta, false);
                }, 300);
            });

            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    btnEnviar.click();
                }
            });

            // Sugerencias r√°pidas
            document.querySelectorAll('.sugerencia-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    let texto = btn.textContent;
                    // Limpiar emojis al inicio
                    texto = texto.replace(/^[üìã‚öñÔ∏èüìäüìòüìñ]/, '').trim();
                    chatInput.value = texto;
                    btnEnviar.click();
                });
            });

            // Selector de estrato
            selectorBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const estrato = this.dataset.estrato;
                    estratoActual = estrato;
                    
                    selectorBtns.forEach(b => {
                        b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                        b.classList.add('bg-slate-100', 'text-slate-700');
                    });
                    this.classList.remove('bg-slate-100', 'text-slate-700');
                    this.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    
                    renderizarEstrato(estrato);
                    
                    // Mensaje de bienvenida espec√≠fico por estrato
                    setTimeout(() => {
                        agregarMensajeChat(`‚úÖ Cambiaste a **${perfiles[estrato].nombre}**. Ya puedes ver tus competencias espec√≠ficas. ¬øNeces√°s ayuda con alguna ley?`, false);
                    }, 500);
                });
            });

            // Inicializar
            document.querySelector('button[data-estrato="tecnico"]').click();
            
            // Mensaje de bienvenida del tutor
            setTimeout(() => {
                agregarMensajeChat("üëã **¬°Bienvenido!** Soy tu tutor especializado en normativa MEP. Record√° que en las pruebas eval√∫an **competencias**, no memoria. Por eso mis preguntas son situaciones pr√°cticas. ¬øEmpezamos?", false);
            }, 1000);
        })();
    </script>
</body>
</html>
